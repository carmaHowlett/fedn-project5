"use strict";var viewModel=function(){function e(e){for(var o=0;o<g.length;o++){null===g[o].map&&g[o].setMap(a),-1===g[o].title.toLowerCase().indexOf(e)&&g[o].setMap(null);for(var t=0;t<p.topPicksFiltered().length;t++)g[o].title.toLowerCase()===p.topPicksFiltered()[t].venue.name.toLowerCase()&&g[o].setMap(a)}}function o(){var e={zoom:14,disableDefaultUI:!0};a=new google.maps.Map(document.getElementById("map-canvas"),e),google.maps.event.addDomListener(window,"resize",function(){var e=a.getCenter();google.maps.event.trigger(a,"resize"),a.setCenter(e)}),l=new google.maps.InfoWindow}function t(e){var o=e.geometry.location.lat(),t=e.geometry.location.lng(),n=new google.maps.LatLng(o,t);a.setCenter(n),a.setZoom(14);var i="https://api.foursquare.com/v2/venues/explore?ll=",r=o+", "+t,l="&limit=15&section=topPicks&day=any&time=any&locale=en",c="&client_id=1AMO01APWLHPX1VNICMSOD2VWXQSDRUMFDSVTSTJZITY2ZQE",g="&client_secret=XYSEVN4ABIDAWIULKL14TM5GABGQP3EWUOYHOH4XIXSWK2JT&v=YYYYMMDD&v=20141121",v=i+r+l+c+g;$.getJSON(v,function(e){$("#listBox").css("display","inline"),p.topPicks(e.response.groups[0].items);for(var o=0;o<p.topPicks().length;o++)s(p.topPicks()[o].venue,p.topPicks()[o].tips)}).error(function(){$("#listBox").css("display","none")})}function n(e,o){return o!=google.maps.places.PlacesServiceStatus.OK?void $("#listBox").css("display","none"):($("#listBox").css("display","inline"),void t(e[0]))}function s(e,o){var t=e.location.lat,n=e.location.lng,s=e.name,i=e.categories[0].name,r=new google.maps.LatLng(t,n),p="TIP: "+o[0].text,c=e.url,v=new google.maps.Marker({map:a,position:r,title:s});g.push(v);var d,u;void 0!==c?(d='</span></p><p><a href="'+c+'" class="v-link" target="_blank">'+c+"</a></p>",u='<div class="infowindow"><p><span class="v-name">'+s+'</span></p><p class="v-category"><span>'+i+d+'<p class="v-tip"><span>'+p):u='<div class="infowindow"><p><span class="v-name">'+s+'</span></p><p class="v-category"><span>'+i+'</span></p><p class="v-tip"><span> '+p,google.maps.event.addListener(v,"click",function(){l.setContent(u),l.open(a,v)}),google.maps.event.addListener(v,"mouseover",function(){l.setContent(u),l.open(a,v)})}function i(e){var o={query:e};r=new google.maps.places.PlacesService(a),r.textSearch(o,n)}var a,r,l,p=this,c="Singapore, Singapore",g=[];p.topPicks=ko.observableArray([]),p.topPicksFiltered=ko.observableArray(p.topPicks()),p.neighborhood=ko.observable(c),p.filterString=ko.observable(""),o(),p.newNeighborhood=ko.computed(function(){""!==p.neighborhood()&&(p.filterString(""),i(p.neighborhood()))}),p.clickVenue=function(e){for(var o=e.venue.name,t=0;t<g.length;t++)o===g[t].title&&(google.maps.event.trigger(g[t],"click"),a.panTo(g[t].position),a.setZoom(15))},p.filterTopPicks=ko.computed(function(){for(var e,o=[],t=p.filterString().toLowerCase(),n=0;n<p.topPicks().length;n++)e=p.topPicks()[n].venue,(-1!=e.name.toLowerCase().indexOf(t)||-1!=e.categories[0].name.toLowerCase().indexOf(t))&&o.push(p.topPicks()[n]);p.topPicksFiltered(o)}),p.filterMarkers=ko.computed(function(){e(p.filterString().toLowerCase())})};$(function(){ko.applyBindings(new viewModel)});